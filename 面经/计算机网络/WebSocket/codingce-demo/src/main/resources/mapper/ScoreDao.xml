<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.com.codingce.demo.dao.ScoreDao">
    <resultMap type="cn.com.codingce.demo.entity.ScoreEntity" id="scoreMap">
        <result property="scoreId" column="score_id"/>
        <result property="studentId" column="student_id"/>
        <result property="courseName" column="course_name"/>
        <result property="score" column="score"/>
    </resultMap>

    <select id="selectMyPageSix" resultType="cn.com.codingce.demo.entity.dto.ChineseScoreDto">
        SELECT tb.class_id,
               tb.class_name,
               tb.class_grade,
               tb.head_teacher,
               min(tsc.score) as minScore,
               max(tsc.score) as maxScore,
               round( avg( tsc.score ), 1 ) AS avgScore
        FROM tb_class tb
                     LEFT JOIN tb_student ts ON ts.class_id = tb.class_id
                     LEFT JOIN tb_score tsc ON tsc.student_id = ts.student_id
        <where>
            ${ew.sqlSegment}
        </where>
        GROUP BY tb.class_id,
                 tb.class_name,
                 tb.class_grade,
                 tb.head_teacher
    </select>

    <select id="selectMyPageSeven" resultType="cn.com.codingce.demo.entity.dto.StudentScoreSumDto">
        SELECT tc.class_name,
               tc.class_grade,
               tc.head_teacher,
               ts.student_id,
               ts.student_name,
               sum(tsc.score) as sumScore
        FROM tb_student ts
                     LEFT JOIN tb_class tc ON tc.class_id = ts.class_id
                     LEFT JOIN tb_score tsc ON tsc.student_id = ts.student_id
        <where>
            ${ew.sqlSegment}
        </where>
        GROUP BY tc.class_name,
                 tc.class_grade,
                 tc.head_teacher,
                 ts.student_id,
                 ts.student_name
    </select>

    <select id="selectMyPageEight" resultType="cn.com.codingce.demo.entity.dto.StudentScoreInfoDto">
        SELECT ts.student_id,
               ts.student_name,
               ts.student_gender,
               ts.student_birth,
               SUM(CASE tsc.course_name WHEN '语文' THEN score ELSE 0 END) AS chineseScore,
               SUM(CASE tsc.course_name WHEN '数学' THEN score ELSE 0 END) AS mathsScore,
               SUM(CASE tsc.course_name WHEN '英语' THEN score ELSE 0 END) AS englishScore,
               SUM(CASE tsc.course_name WHEN '物理' THEN score ELSE 0 END) AS physicsScore,
               SUM(CASE tsc.course_name WHEN '化学' THEN score ELSE 0 END) AS chemistryScore,
               SUM(CASE tsc.course_name WHEN '生物' THEN score ELSE 0 END) AS biologyScore,
               SUM(tsc.score)                                            AS sumScore
        FROM tb_student ts
                     LEFT JOIN tb_class tc ON tc.class_id = ts.class_id
                     LEFT JOIN tb_score tsc ON tsc.student_id = ts.student_id
        <where>
            ${ew.sqlSegment}
        </where>
        GROUP BY ts.student_id,
                 ts.student_name,
                 ts.student_gender,
                 ts.student_birth
    </select>
</mapper>